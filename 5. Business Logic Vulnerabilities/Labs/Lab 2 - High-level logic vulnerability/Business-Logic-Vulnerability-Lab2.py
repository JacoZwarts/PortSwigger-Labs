import sys
import requests
import urllib3
from bs4 import BeautifulSoup

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxies = {"http":"http://127.0.0.1:8080","https":"http://127.0.0.1:8080"}

def main():
    if len(sys.argv) != 2:
        print("⚠️  Usage: %s <url>" % sys.argv[0])
        print("⚠️  Example: %s www.example.com " % sys.argv[0])
    else:
        session = requests.Session()
        url = remove_trailing_slash(sys.argv[1])
        exploit_business_logic_vulnerability(url,session)

def exploit_business_logic_vulnerability(url,session):
    get_csrf_token(url,session)
    # GET CSRF Token
    # Login
    # Add Item to cart
    # Add ITem to cart
    # Get CSRF Token
    # Checkout
def get_csrf_token(url,session):
    response = session.get(url+"/login",Verify=False,proxies=proxies)
    text = BeautifulSoup(response.text,"html.parser")
    csrf_token = text.find("input",{"name":"csrf"})["value"]
    return csrf_token

def remove_trailing_slash(url):
    if url.endswith("/"):
        return url[:-1]
    return url

if __name__ == "__main__":
    main()


